<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=muqxIubVMYH11GIOLp6nGTqm2QEZTqBy"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
    <title>热力图功能示例</title>
    <style type="text/css">
		ul,li{list-style: none;margin:0;padding:0;float:left;}
		html{height:100%}
		body{height:100%;margin:0px;padding:0px;font-family:"微软雅黑";}
		#container{height:500px;width:100%;}
		#r-result{width:100%;}
    </style>	
</head>
<body>
	<div id="container"></div>
	<div id="r-result">
		<input type="button"  onclick="openHeatmap();" value="show heat map"/><input type="button"  onclick="closeHeatmap();" value="close heat map"/>
	</div>
</body>
</html>
<script type="text/javascript">
    var map = new BMap.Map("container");          // 创建地图实例

    var point = new BMap.Point(113.418261, 33.921984);
    map.centerAndZoom(point, 5);             // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(); // 允许滚轮缩放
  
    var points =[
	{"lng":121.302632,"lat":43.622878,"count":526.209891},
	{"lng":121.436542,"lat":44.987676,"count":680.287182},
	{"lng":118.350430,"lat":42.793796,"count":648.167104},
	{"lng":123.037000,"lat":44.153377,"count":658.210874},
	{"lng":122.572550,"lat":46.268946,"count":698.832154},
	{"lng":119.268169,"lat":42.184131,"count":698.481301},
	{"lng":116.795172,"lat":43.065594,"count":656.670499},
	{"lng":120.949421,"lat":44.275303,"count":701.275736},
	{"lng":118.898489,"lat":42.260361,"count":702.665955},
	{"lng":122.233664,"lat":43.371961,"count":697.141886},
	{"lng":121.261340,"lat":44.020139,"count":761.046469},
	{"lng":116.628012,"lat":42.684054,"count":697.036684},
	{"lng":121.371114,"lat":46.498876,"count":603.514910},
	{"lng":119.843897,"lat":49.267944,"count":716.354609},
	{"lng":121.009091,"lat":43.282674,"count":581.324399},
	{"lng":123.342371,"lat":43.676121,"count":697.332054},
	{"lng":119.961072,"lat":44.387352,"count":668.731958},
	{"lng":118.246907,"lat":42.630319,"count":697.216839},
	{"lng":118.659909,"lat":43.530698,"count":693.262726},
	{"lng":124.707052,"lat":40.346319,"count":730.220735},
	{"lng":119.075244,"lat":42.330795,"count":697.482884},
	{"lng":121.399574,"lat":43.779260,"count":697.249174},
	{"lng":121.956600,"lat":42.845098,"count":532.847881},
	{"lng":115.488323,"lat":43.351048,"count":742.646456},
	{"lng":119.836749,"lat":49.263201,"count":707.886606},
	{"lng":122.241323,"lat":42.865682,"count":698.061049},
	{"lng":118.461556,"lat":44.777363,"count":688.054085},
	{"lng":122.305962,"lat":43.630136,"count":660.300195},
	{"lng":119.363884,"lat":44.009072,"count":506.567359},
	{"lng":120.026302,"lat":40.305129,"count":695.648134},
	{"lng":118.830549,"lat":43.575552,"count":664.080560},
	{"lng":118.930599,"lat":42.334397,"count":442.442298},
	{"lng":121.922580,"lat":43.589756,"count":697.190106},
	{"lng":124.689242,"lat":40.459444,"count":665.992826},
	{"lng":121.572298,"lat":43.337750,"count":942.494690},
	{"lng":117.642808,"lat":44.568764,"count":682.166129},
	{"lng":118.966165,"lat":42.262756,"count":735.884815},
	{"lng":119.260631,"lat":42.279963,"count":696.801484},
	{"lng":122.279269,"lat":43.611211,"count":703.595683},
	{"lng":119.760111,"lat":49.154739,"count":710.319787},
	{"lng":122.019128,"lat":46.078120,"count":697.855860},
	{"lng":122.991934,"lat":41.091273,"count":692.318648},
	{"lng":119.666036,"lat":45.537200,"count":697.140863},
	{"lng":119.652480,"lat":45.522235,"count":712.118149},
	{"lng":116.094619,"lat":43.941284,"count":737.991869},
	{"lng":122.392895,"lat":46.348715,"count":855.666280},
	{"lng":121.830750,"lat":44.893718,"count":573.033869},
	{"lng":119.833578,"lat":42.733717,"count":704.009712},
	{"lng":118.951439,"lat":42.311299,"count":694.448382},
	{"lng":125.383973,"lat":45.129789,"count":713.900596},
	{"lng":126.541162,"lat":43.814725,"count":779.153248},
	{"lng":126.698202,"lat":43.654515,"count":705.568820},
	{"lng":125.968827,"lat":44.194372,"count":683.856994},
	{"lng":126.156280,"lat":41.772626,"count":691.374004},
	{"lng":126.529194,"lat":43.837430,"count":726.861537},
	{"lng":126.535864,"lat":43.838856,"count":679.271698},
	{"lng":123.443074,"lat":44.493516,"count":659.209311},
	{"lng":127.165482,"lat":42.343004,"count":705.840677},
	{"lng":123.708520,"lat":43.767695,"count":698.348355},
	{"lng":126.564544,"lat":43.871988,"count":677.023843},
	{"lng":126.579656,"lat":43.906264,"count":676.395863},
	{"lng":124.391382,"lat":43.175525,"count":702.520430},
	{"lng":122.330666,"lat":44.604179,"count":704.218119},
	{"lng":126.565019,"lat":42.856481,"count":727.881581},
	{"lng":124.436630,"lat":43.089848,"count":715.982676},
	{"lng":129.471301,"lat":43.059667,"count":684.141457},
	{"lng":126.535864,"lat":43.838856,"count":699.175914},
	{"lng":126.543978,"lat":43.829860,"count":702.405651},
	{"lng":126.630186,"lat":43.839229,"count":705.122888},
	{"lng":126.574176,"lat":43.834165,"count":727.497935},
	{"lng":126.396643,"lat":41.791642,"count":697.185844},
	{"lng":130.702367,"lat":43.074719,"count":700.782418},
	{"lng":129.005313,"lat":42.563374,"count":672.777772},
	{"lng":122.840777,"lat":45.621086,"count":694.866940},
	{"lng":126.435798,"lat":41.945859,"count":693.945216},
	{"lng":127.056399,"lat":42.991653,"count":705.564797},
	{"lng":125.133686,"lat":42.923303,"count":698.021412},
	{"lng":126.069684,"lat":42.916297,"count":690.178484},
	{"lng":125.313642,"lat":43.898338,"count":702.522695},
	{"lng":125.313642,"lat":43.898338,"count":698.178306},
	{"lng":125.313642,"lat":43.898338,"count":689.718972},
	{"lng":125.313642,"lat":43.898338,"count":709.400862},
	{"lng":126.479857,"lat":44.521726,"count":694.510698},
	{"lng":124.338543,"lat":40.129023,"count":678.190589},
	{"lng":124.338543,"lat":40.129023,"count":686.965168},
	{"lng":122.000169,"lat":40.191425,"count":697.140038},
	{"lng":121.285575,"lat":41.152566,"count":652.169327},
	{"lng":120.461474,"lat":41.566709,"count":685.657442},
	{"lng":120.664645,"lat":41.137036,"count":695.194721},
	{"lng":124.717527,"lat":40.699301,"count":697.260171},
	{"lng":122.935260,"lat":41.732935,"count":684.415460},
	{"lng":122.691903,"lat":39.243906,"count":675.436914},
	{"lng":121.976776,"lat":39.399424,"count":701.754838},
	{"lng":121.290021,"lat":41.533877,"count":688.251138},
	{"lng":121.648523,"lat":38.962567,"count":711.448967},
	{"lng":121.648523,"lat":38.962567,"count":695.813000},
	{"lng":125.171491,"lat":40.878947,"count":701.915824},
	{"lng":122.934145,"lat":39.858910,"count":662.424445},
	{"lng":123.064608,"lat":42.693946,"count":679.518163},
	{"lng":122.502418,"lat":42.141551,"count":689.980701},
	{"lng":123.904050,"lat":41.881110,"count":720.984846},
	{"lng":123.929820,"lat":41.877304,"count":708.608538},
	{"lng":123.946409,"lat":43.000462,"count":685.107827},
	{"lng":120.488982,"lat":41.609868,"count":697.149128},
	{"lng":123.778062,"lat":41.325838,"count":687.596321},
	{"lng":125.290028,"lat":41.261816,"count":688.790059},
	{"lng":123.504363,"lat":41.821255,"count":713.206410},
	{"lng":123.244949,"lat":41.798272,"count":680.593640},
	{"lng":122.364757,"lat":39.778648,"count":674.237698},
	{"lng":124.275780,"lat":42.508557,"count":717.352107},
	{"lng":120.336360,"lat":41.518421,"count":749.828219},
	{"lng":122.079152,"lat":41.984761,"count":717.779756},
	{"lng":121.528500,"lat":38.955462,"count":698.245078},
	{"lng":122.073228,"lat":41.141248,"count":713.197470},
	{"lng":121.574238,"lat":39.767219,"count":713.972658},
	{"lng":123.227645,"lat":41.363448,"count":698.743016},
	{"lng":123.496911,"lat":41.867944,"count":694.561005},
	{"lng":124.102909,"lat":41.932564,"count":697.182417},
	{"lng":123.426289,"lat":41.589345,"count":684.259117},
	{"lng":122.233391,"lat":40.668651,"count":682.048187},
	{"lng":122.233391,"lat":40.668651,"count":695.136607},
	{"lng":123.584348,"lat":42.442930,"count":682.325542},
	{"lng":123.421287,"lat":41.779620,"count":712.993979},
	{"lng":122.554004,"lat":39.576203,"count":736.983359},
	{"lng":121.986995,"lat":39.408202,"count":706.567600},
	{"lng":123.854850,"lat":42.299757,"count":697.174688},
	{"lng":121.147749,"lat":41.130879,"count":686.346471},
	{"lng":121.147749,"lat":41.130879,"count":696.807881},
	{"lng":121.147749,"lat":41.130879,"count":689.503998},
	{"lng":122.130706,"lat":41.870719,"count":729.190409},
	{"lng":123.296707,"lat":40.279924,"count":703.995864},
	{"lng":121.660822,"lat":42.019250,"count":698.655963},
	{"lng":121.751500,"lat":41.946876,"count":647.712648},
	{"lng":121.660822,"lat":42.019250,"count":674.662828},
	{"lng":121.660822,"lat":42.019250,"count":663.903058},
	{"lng":123.007763,"lat":41.118744,"count":725.782171},
	{"lng":122.936257,"lat":41.153031,"count":697.143018},
	{"lng":120.625837,"lat":41.583791,"count":653.641999},
	{"lng":121.303001,"lat":38.849472,"count":697.101486},
	{"lng":131.019048,"lat":45.775005,"count":698.536515},
	{"lng":126.664073,"lat":45.726736,"count":677.475194},
	{"lng":128.900580,"lat":47.741959,"count":696.150273},
	{"lng":130.284735,"lat":46.813780,"count":707.377464},
	{"lng":132.414750,"lat":45.234264,"count":658.374488},
	{"lng":126.818061,"lat":45.739872,"count":691.839933},
	{"lng":131.171402,"lat":46.655102,"count":709.706336},
	{"lng":131.171402,"lat":46.655102,"count":669.723570},
	{"lng":126.579604,"lat":45.925777,"count":563.396960},
	{"lng":128.622721,"lat":47.744068,"count":697.141290},
	{"lng":126.705452,"lat":45.786599,"count":692.808509},
	{"lng":126.266360,"lat":46.226700,"count":697.805971},
	{"lng":126.609533,"lat":45.753329,"count":683.142841},
	{"lng":126.666278,"lat":45.644424,"count":703.151643},
	{"lng":126.698009,"lat":45.714725,"count":697.420537},
	{"lng":127.591919,"lat":45.577180,"count":601.151049},
	{"lng":125.021840,"lat":46.596709,"count":701.792737},
	{"lng":129.829661,"lat":46.256111,"count":651.733398},
	{"lng":131.160554,"lat":46.694278,"count":223.997757},
	{"lng":129.827939,"lat":46.487071,"count":700.311720},
	{"lng":129.604038,"lat":44.580070,"count":718.484501},
	{"lng":123.633372,"lat":47.220163,"count":696.765959},
	{"lng":123.633372,"lat":47.220163,"count":712.971807},
	{"lng":124.511244,"lat":48.484677,"count":678.178206},
	{"lng":124.602272,"lat":46.745140,"count":696.914911},
	{"lng":126.840306,"lat":45.624483,"count":699.914128},
	{"lng":126.679488,"lat":45.745088,"count":697.141111},
	{"lng":129.616707,"lat":44.543619,"count":696.250717},
	{"lng":129.621775,"lat":44.567526,"count":714.118391},
	{"lng":131.886750,"lat":45.555026,"count":731.974483},
	{"lng":123.999074,"lat":47.368017,"count":696.993828},
	{"lng":124.543521,"lat":46.493478,"count":697.153926},
	{"lng":126.801953,"lat":46.346219,"count":690.648213},
	{"lng":126.982721,"lat":46.639126,"count":701.845586},
	{"lng":126.578635,"lat":45.724506,"count":634.087980},
	{"lng":129.027104,"lat":44.010419,"count":683.619332},
	{"lng":130.794693,"lat":46.245896,"count":434.553931},
	{"lng":130.941767,"lat":45.321540,"count":694.220841},
	{"lng":130.941767,"lat":45.321540,"count":708.202422},
	{"lng":130.292472,"lat":47.338666,"count":689.157695},
	{"lng":130.292472,"lat":47.338666,"count":691.255271},
	{"lng":124.066419,"lat":47.377812,"count":695.488662}];
	   
    if(!isSupportCanvas()){
    	alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~')
    }
	//详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md
	//参数说明如下:
	/* visible 热力图是否显示,默认为true
     * opacity 热力的透明度,1-100
     * radius 势力图的每个点的半径大小   
     * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
     *	{
			.2:'rgb(0, 255, 255)',
			.5:'rgb(0, 110, 255)',
			.8:'rgb(100, 0, 255)'
		}
		其中 key 表示插值的位置, 0~1. 
		    value 为颜色值. 
     */
	heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":20});
	map.addOverlay(heatmapOverlay);
	heatmapOverlay.setDataSet({data:points,max:1000}); //只需要调节max中的值就可以，也就是最高电压等级，越接近这个值就越红，越不接近越蓝
	//是否显示热力图
    function openHeatmap(){
        heatmapOverlay.show();
    }
	function closeHeatmap(){
        heatmapOverlay.hide();
    }
	closeHeatmap();
    function setGradient(){
     	/*格式如下所示:
		{
	  		0:'rgb(102, 255, 0)',
	 	 	.5:'rgb(255, 170, 0)',
		  	1:'rgb(255, 0, 0)'
		}*/
     	var gradient = {};
     	var colors = document.querySelectorAll("input[type='color']");
     	colors = [].slice.call(colors,0);
     	colors.forEach(function(ele){
			gradient[ele.getAttribute("data-key")] = ele.value; 
     	});
        heatmapOverlay.setOptions({"gradient":gradient});
    }
	//判断浏览区是否支持canvas
    function isSupportCanvas(){
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
</script>
