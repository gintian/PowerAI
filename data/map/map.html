<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=muqxIubVMYH11GIOLp6nGTqm2QEZTqBy"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
    <title>热力图功能示例</title>
    <style type="text/css">
		ul,li{list-style: none;margin:0;padding:0;float:left;}
		html{height:100%}
		body{height:100%;margin:0px;padding:0px;font-family:"微软雅黑";}
		#container{height:500px;width:100%;}
		#r-result{width:100%;}
    </style>	
</head>
<body>
	<div id="container"></div>
	<div id="r-result">
		<input type="button"  onclick="openHeatmap();" value="show heat map"/><input type="button"  onclick="closeHeatmap();" value="close heat map"/>
	</div>
</body>
</html>
<script type="text/javascript">
    var map = new BMap.Map("container");          // 创建地图实例

    var point = new BMap.Point(113.418261, 33.921984);
    map.centerAndZoom(point, 5);             // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(); // 允许滚轮缩放
  
    var points =[
	{"lng":121.302632,"lat":43.622878,"count":-40.770279},
	{"lng":121.436542,"lat":44.987676,"count":-4.019961},
	{"lng":118.350430,"lat":42.793796,"count":-11.681193},
	{"lng":123.037000,"lat":44.153377,"count":-9.285573},
	{"lng":122.572550,"lat":46.268946,"count":0.403367},
	{"lng":119.268169,"lat":42.184131,"count":0.319684},
	{"lng":116.795172,"lat":43.065594,"count":-9.652979},
	{"lng":120.949421,"lat":44.275303,"count":0.986209},
	{"lng":118.898489,"lat":42.260361,"count":1.317792},
	{"lng":122.233664,"lat":43.371961,"count":0.000204},
	{"lng":121.261340,"lat":44.020139,"count":15.242653},
	{"lng":116.628012,"lat":42.684054,"count":-0.024884},
	{"lng":121.371114,"lat":46.498876,"count":-22.331589},
	{"lng":119.843897,"lat":49.267944,"count":4.582795},
	{"lng":121.009091,"lat":43.282674,"count":-27.624434},
	{"lng":123.342371,"lat":43.676121,"count":0.045558},
	{"lng":119.961072,"lat":44.387352,"count":-6.776099},
	{"lng":118.246907,"lat":42.630319,"count":0.018083},
	{"lng":118.659909,"lat":43.530698,"count":-0.925050},
	{"lng":124.707052,"lat":40.346319,"count":7.890133},
	{"lng":119.075244,"lat":42.330795,"count":0.081538},
	{"lng":121.399574,"lat":43.779260,"count":0.025792},
	{"lng":121.956600,"lat":42.845098,"count":-39.187004},
	{"lng":115.488323,"lat":43.351048,"count":10.853902},
	{"lng":119.836749,"lat":49.263201,"count":2.563024},
	{"lng":122.241323,"lat":42.865682,"count":0.219438},
	{"lng":118.461556,"lat":44.777363,"count":-2.167401},
	{"lng":122.305962,"lat":43.630136,"count":-8.787225},
	{"lng":119.363884,"lat":44.009072,"count":-45.455395},
	{"lng":120.026302,"lat":40.305129,"count":-0.356087},
	{"lng":118.830549,"lat":43.575552,"count":-7.885547},
	{"lng":118.930599,"lat":42.334397,"count":-60.750427},
	{"lng":121.922580,"lat":43.589756,"count":0.011700},
	{"lng":124.689242,"lat":40.459444,"count":-7.429431},
	{"lng":121.572298,"lat":43.337750,"count":58.521446},
	{"lng":117.642808,"lat":44.568764,"count":-3.571791},
	{"lng":118.966165,"lat":42.262756,"count":9.241120},
	{"lng":119.260631,"lat":42.279963,"count":-0.080988},
	{"lng":122.279269,"lat":43.611211,"count":1.539552},
	{"lng":119.760111,"lat":49.154739,"count":3.143379},
	{"lng":122.019128,"lat":46.078120,"count":0.170502},
	{"lng":122.991934,"lat":41.091273,"count":-1.150235},
	{"lng":119.666036,"lat":45.537200,"count":-0.000042},
	{"lng":119.652480,"lat":45.522235,"count":3.572329},
	{"lng":116.094619,"lat":43.941284,"count":9.743697},
	{"lng":122.392895,"lat":46.348715,"count":37.811253},
	{"lng":121.830750,"lat":44.893718,"count":-29.601885},
	{"lng":119.833578,"lat":42.733717,"count":1.638310},
	{"lng":118.951439,"lat":42.311299,"count":-0.642255},
	{"lng":125.383973,"lat":45.129789,"count":3.997471},
	{"lng":126.541162,"lat":43.814725,"count":19.561462},
	{"lng":126.698202,"lat":43.654515,"count":2.010188},
	{"lng":125.968827,"lat":44.194372,"count":-3.168495},
	{"lng":126.156280,"lat":41.772626,"count":-1.375545},
	{"lng":126.529194,"lat":43.837430,"count":7.088900},
	{"lng":126.535864,"lat":43.838856,"count":-4.262170},
	{"lng":123.443074,"lat":44.493516,"count":-9.047431},
	{"lng":127.165482,"lat":42.343004,"count":2.075022},
	{"lng":123.708520,"lat":43.767695,"count":0.287968},
	{"lng":126.564544,"lat":43.871988,"count":-4.798326},
	{"lng":126.579656,"lat":43.906264,"count":-4.948108},
	{"lng":124.391382,"lat":43.175525,"count":1.283089},
	{"lng":122.330666,"lat":44.604179,"count":1.688016},
	{"lng":126.565019,"lat":42.856481,"count":7.332201},
	{"lng":124.436630,"lat":43.089848,"count":4.494077},
	{"lng":129.471301,"lat":43.059667,"count":-3.100638},
	{"lng":126.535864,"lat":43.838856,"count":0.485361},
	{"lng":126.543978,"lat":43.829860,"count":1.255709},
	{"lng":126.630186,"lat":43.839229,"count":1.903827},
	{"lng":126.574176,"lat":43.834165,"count":7.240686},
	{"lng":126.396643,"lat":41.791642,"count":0.010686},
	{"lng":130.702367,"lat":43.074719,"count":0.868537},
	{"lng":129.005313,"lat":42.563374,"count":-5.811098},
	{"lng":122.840777,"lat":45.621086,"count":-2.262462},
	{"lng":122.840777,"lat":45.621086,"count":1.177628},
	{"lng":126.435798,"lat":41.945859,"count":-0.511735},
	{"lng":126.435798,"lat":41.945859,"count":-1.639102},
	{"lng":127.056399,"lat":42.991653,"count":2.009227},
	{"lng":125.133686,"lat":42.923303,"count":0.209996},
	{"lng":126.069684,"lat":42.916297,"count":-1.660699},
	{"lng":125.313642,"lat":43.898338,"count":1.283628},
	{"lng":125.313642,"lat":43.898338,"count":0.247407},
	{"lng":125.313642,"lat":43.898338,"count":-1.770304},
	{"lng":125.313642,"lat":43.898338,"count":2.924199},
	{"lng":126.479857,"lat":44.521726,"count":-0.627379},
	{"lng":124.338543,"lat":40.129023,"count":-4.520041},
	{"lng":124.338543,"lat":40.129023,"count":-2.427133},
	{"lng":122.000169,"lat":40.191425,"count":-0.000235},
	{"lng":121.285575,"lat":41.152566,"count":-10.726595},
	{"lng":120.461474,"lat":41.566709,"count":-2.739051},
	{"lng":120.664645,"lat":41.137036,"count":-0.464231},
	{"lng":124.717527,"lat":40.699301,"count":0.028419},
	{"lng":122.935260,"lat":41.732935,"count":-3.035287},
	{"lng":122.691903,"lat":39.243906,"count":-5.176835},
	{"lng":121.976776,"lat":39.399424,"count":1.100477},
	{"lng":121.290021,"lat":41.533877,"count":-2.120406},
	{"lng":121.648523,"lat":38.962567,"count":3.412710},
	{"lng":121.648523,"lat":38.962567,"count":-0.316759},
	{"lng":121.062715,"lat":41.410679,"count":0.301705},
	{"lng":125.171491,"lat":40.878947,"count":1.138878},
	{"lng":122.934145,"lat":39.858910,"count":-8.280553},
	{"lng":123.064608,"lat":42.693946,"count":-4.203389},
	{"lng":122.502418,"lat":42.141551,"count":-1.707871},
	{"lng":123.904050,"lat":41.881110,"count":5.687206},
	{"lng":123.929820,"lat":41.877304,"count":2.735219},
	{"lng":123.946409,"lat":43.000462,"count":-2.870152},
	{"lng":120.488982,"lat":41.609868,"count":0.001928},
	{"lng":123.778062,"lat":41.325838,"count":-2.276590},
	{"lng":125.290028,"lat":41.261816,"count":-1.991864},
	{"lng":123.504363,"lat":41.821255,"count":3.831894},
	{"lng":123.244949,"lat":41.798272,"count":-3.946861},
	{"lng":122.364757,"lat":39.778648,"count":-5.462872},
	{"lng":124.275780,"lat":42.508557,"count":4.820720},
	{"lng":120.336360,"lat":41.518421,"count":12.566887},
	{"lng":122.079152,"lat":41.984761,"count":4.922737},
	{"lng":121.528500,"lat":38.955462,"count":0.263335},
	{"lng":122.073228,"lat":41.141248,"count":3.829762},
	{"lng":121.574238,"lat":39.767219,"count":4.014663},
	{"lng":123.227645,"lat":41.363448,"count":0.382108},
	{"lng":123.496911,"lat":41.867944,"count":-0.615393},
	{"lng":124.102909,"lat":41.932564,"count":0.009869},
	{"lng":123.426289,"lat":41.589345,"count":-3.072577},
	{"lng":122.233391,"lat":40.668651,"count":-3.599925},
	{"lng":122.233391,"lat":40.668651,"count":-0.478089},
	{"lng":123.584348,"lat":42.442930,"count":-3.533771},
	{"lng":123.421287,"lat":41.779620,"count":3.781227},
	{"lng":122.554004,"lat":39.576203,"count":9.503144},
	{"lng":121.986995,"lat":39.408202,"count":2.248410},
	{"lng":123.854850,"lat":42.299757,"count":0.008033},
	{"lng":121.147749,"lat":41.130879,"count":-2.574703},
	{"lng":121.147749,"lat":41.130879,"count":-0.079459},
	{"lng":121.147749,"lat":41.130879,"count":-1.821580},
	{"lng":122.130706,"lat":41.870719,"count":7.644375},
	{"lng":123.296707,"lat":40.279924,"count":1.635008},
	{"lng":121.660822,"lat":42.019250,"count":0.361344},
	{"lng":121.751500,"lat":41.946876,"count":-11.789591},
	{"lng":121.660822,"lat":42.019250,"count":-5.361470},
	{"lng":121.660822,"lat":42.019250,"count":-7.927880},
	{"lng":123.007763,"lat":41.118744,"count":6.831453},
	{"lng":122.936257,"lat":41.153031,"count":0.000474},
	{"lng":120.625837,"lat":41.583791,"count":-10.375328},
	{"lng":121.303001,"lat":38.849472,"count":-0.009431},
	{"lng":131.019048,"lat":45.775005,"count":0.332846},
	{"lng":126.664073,"lat":45.726736,"count":-4.690666},
	{"lng":128.900580,"lat":47.741959,"count":-0.236320},
	{"lng":130.284735,"lat":46.813780,"count":2.441583},
	{"lng":132.414750,"lat":45.234264,"count":-9.246556},
	{"lng":126.818061,"lat":45.739872,"count":-1.264415},
	{"lng":131.171402,"lat":46.655102,"count":2.997062},
	{"lng":131.171402,"lat":46.655102,"count":-6.539572},
	{"lng":126.579604,"lat":45.925777,"count":-31.900472},
	{"lng":128.622721,"lat":47.744068,"count":0.000056},
	{"lng":126.705452,"lat":45.786599,"count":-1.033387},
	{"lng":126.266360,"lat":46.226700,"count":0.158607},
	{"lng":126.609533,"lat":45.753329,"count":-3.338832},
	{"lng":126.666278,"lat":45.644424,"count":1.433636},
	{"lng":126.698009,"lat":45.714725,"count":0.066670},
	{"lng":127.591919,"lat":45.577180,"count":-22.895412},
	{"lng":125.021840,"lat":46.596709,"count":1.109518},
	{"lng":129.829661,"lat":46.256111,"count":-10.830562},
	{"lng":131.160554,"lat":46.694278,"count":-112.853550},
	{"lng":129.827939,"lat":46.487071,"count":0.756276},
	{"lng":129.604038,"lat":44.580070,"count":5.090822},
	{"lng":123.633372,"lat":47.220163,"count":-0.089464},
	{"lng":123.633372,"lat":47.220163,"count":3.775933},
	{"lng":124.511244,"lat":48.484677,"count":-4.522994},
	{"lng":124.602272,"lat":46.745140,"count":-0.053932},
	{"lng":126.840306,"lat":45.624483,"count":0.661438},
	{"lng":126.679488,"lat":45.745088,"count":0.000021},
	{"lng":129.616707,"lat":44.543619,"count":-0.212357},
	{"lng":129.621775,"lat":44.567526,"count":4.049420},
	{"lng":131.886750,"lat":45.555026,"count":8.308420},
	{"lng":123.999074,"lat":47.368017,"count":-0.035114},
	{"lng":129.412547,"lat":45.766807,"count":-0.000000},
	{"lng":124.543521,"lat":46.493478,"count":0.003087},
	{"lng":126.801953,"lat":46.346219,"count":-1.548661},
	{"lng":126.982721,"lat":46.639126,"count":1.122128},
	{"lng":126.578635,"lat":45.724506,"count":-15.039331},
	{"lng":129.027104,"lat":44.010419,"count":-3.225181},
	{"lng":130.794693,"lat":46.245896,"count":-62.631952},
	{"lng":130.941767,"lat":45.321540,"count":-0.696514},
	{"lng":130.941767,"lat":45.321540,"count":2.638346},
	{"lng":130.292472,"lat":47.338666,"count":-1.904173},
	{"lng":130.292472,"lat":47.338666,"count":-1.403873},
	{"lng":124.066419,"lat":47.377812,"count":-0.394119}];
	   
    if(!isSupportCanvas()){
    	alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~')
    }
	//详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md
	//参数说明如下:
	/* visible 热力图是否显示,默认为true
     * opacity 热力的透明度,1-100
     * radius 势力图的每个点的半径大小   
     * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
     *	{
			.2:'rgb(0, 255, 255)',
			.5:'rgb(0, 110, 255)',
			.8:'rgb(100, 0, 255)'
		}
		其中 key 表示插值的位置, 0~1. 
		    value 为颜色值. 
     */
	heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":20});
	map.addOverlay(heatmapOverlay);
	heatmapOverlay.setDataSet({data:points,max:1000}); //只需要调节max中的值就可以，也就是最高电压等级，越接近这个值就越红，越不接近越蓝
	//是否显示热力图
    function openHeatmap(){
        heatmapOverlay.show();
    }
	function closeHeatmap(){
        heatmapOverlay.hide();
    }
	closeHeatmap();
    function setGradient(){
     	/*格式如下所示:
		{
	  		0:'rgb(102, 255, 0)',
	 	 	.5:'rgb(255, 170, 0)',
		  	1:'rgb(255, 0, 0)'
		}*/
     	var gradient = {};
     	var colors = document.querySelectorAll("input[type='color']");
     	colors = [].slice.call(colors,0);
     	colors.forEach(function(ele){
			gradient[ele.getAttribute("data-key")] = ele.value; 
     	});
        heatmapOverlay.setOptions({"gradient":gradient});
    }
	//判断浏览区是否支持canvas
    function isSupportCanvas(){
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
</script>
